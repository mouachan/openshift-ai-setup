apiVersion: batch/v1
kind: Job
metadata:
  name: minio-bucket-init-triton
  namespace: minio
  labels:
    app.kubernetes.io/name: minio-bucket-init-triton
    app.kubernetes.io/part-of: triton-demo
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/name: minio-bucket-init-triton
        app.kubernetes.io/part-of: triton-demo
    spec:
      serviceAccountName: minio-admin
      containers:
      - name: bucket-init
        image: minio/mc:latest
        command:
        - /bin/bash
        - -c
        args:
        - |
          echo "ðŸš€ Initialisation des buckets S3 pour Triton Demo"
          echo "================================================"
          
          # Configuration MinIO
          mc alias set myminio http://minio-api:9000 minioadmin minioadmin
          
          # CrÃ©er les buckets gÃ©nÃ©riques
          echo "ðŸ“¦ CrÃ©ation du bucket data..."
          mc mb myminio/data --ignore-existing
          
          echo "ðŸ“¦ CrÃ©ation du bucket models..."
          mc mb myminio/models --ignore-existing
          
          # Configurer les politiques d'accÃ¨s
          echo "ðŸ” Configuration des politiques d'accÃ¨s..."
          mc policy set download myminio/data
          mc policy set download myminio/models
          
          # CrÃ©er la structure de dossiers pour Iris
          echo "ðŸ“ CrÃ©ation de la structure de dossiers..."
          echo "Iris dataset structure" > iris-data-info.txt
          echo "Iris model structure" > iris-models-info.txt
          
          mc cp iris-data-info.txt myminio/data/iris-data/
          mc cp iris-models-info.txt myminio/models/iris-models/
          
          # Lister les buckets
          echo "ðŸ“‹ Buckets crÃ©Ã©s:"
          mc ls myminio/
          
          echo "âœ… Initialisation terminÃ©e avec succÃ¨s!"
        env:
        - name: MINIO_ENDPOINT
          value: "http://minio-api:9000"
        - name: MINIO_ACCESS_KEY
          value: "minioadmin"
        - name: MINIO_SECRET_KEY
          value: "minioadmin"
      restartPolicy: OnFailure
      backoffLimit: 3 